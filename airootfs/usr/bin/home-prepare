#!/bin/bash
. /etc/os-release

HOME_DEVICE=/dev/disk/by-label/$ID-home

# abort while no home exists
if mountpoint /home/user &> /dev/null; then
  echo "Already mounted and set up."
  exit
fi

# mount user home
mount $HOME_DEVICE /home/user
chown user:user /home/user

# populate user home
mkdir -p /home/user/.config/autostart/
cp /usr/share/applications/live-launcher.desktop /home/user/.config/autostart/

# save/reload network settings
mkdir -p /home/user/.network-connections
cp -f /etc/NetworkManager/system-connections/* /home/user/.network-connections/
rm -rf /etc/NetworkManager/system-connections
ln -s /home/user/.network-connections/ /etc/NetworkManager/system-connections
systemctl restart NetworkManager
